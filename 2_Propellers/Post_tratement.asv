clear all
close all
clc

%% DA4022_2B
% Static formalisme RPM CT CP
DA4022_2B.Static = [ 1326.667  0.146329  0.087607
                     1433.333  0.150878  0.089766
                     1700.000  0.152442  0.088946
                     1953.333  0.146078  0.083298
                     2210.000  0.146178  0.081402
                     2530.000  0.147843  0.080288
                     2686.667  0.147452  0.079276
                     2943.333  0.146372  0.077756
                     3256.667  0.146333  0.076829
                     3493.333  0.145205  0.075765
                     3710.000  0.147485  0.076383
                     3950.000  0.149582  0.077088
                     4200.000  0.149532  0.076649
                     4450.000  0.150186  0.076846
                     4693.333  0.150883  0.076885
                     4933.333  0.151599  0.077399
                     5183.333  0.153229  0.078077
                     5463.333  0.153899  0.078517
                     5710.000  0.154860  0.079018
                     5940.000  0.156683  0.079983 ];

% INFLOW
% 2018 RPM : J CT CP eta


DA4022_2B.Dynamic{1} = [0.304309  0.110579  0.075261  0.447105
                        0.385022  0.096197  0.070280  0.526993
                        0.468394  0.080331  0.064302  0.585157
                        0.543693  0.063328  0.055463  0.620794
                        0.647059  0.034468  0.038604  0.577723
                        0.697733  0.023081  0.031191  0.516305
                        0.788781  0.001221  0.016022  0.060102];


% 3039 RPM : J CT CP eta



DA4022_2B.Dynamic{2} = [ 0.202333  0.122440  0.074159  0.334067
                         0.254818  0.115343  0.072566  0.405031
                         0.304823  0.107865  0.070591  0.465775
                         0.358332  0.098333  0.067612  0.521145
                         0.409945  0.090740  0.065467  0.568206
                         0.479275  0.078043  0.061013  0.613059
                         0.519593  0.068232  0.056000  0.633086
                         0.571355  0.058896  0.051647  0.651545
                         0.624202  0.043611  0.042802  0.636009
                         0.674348  0.033583  0.037061  0.611067
                         0.727243  0.016881  0.025658  0.478446
                         0.776227  0.004856  0.017283  0.218126];


% 4042 RPM : J CT CP eta

DA4022_2B.Dynamic{3} = [ 0.152627  0.133145  0.075633  0.268687
                         0.189171  0.128293  0.074873  0.324143
                         0.231534  0.122225  0.073717  0.383887
                         0.270946  0.116646  0.072550  0.435626
                         0.308225  0.108695  0.069888  0.479375
                         0.346701  0.102766  0.068363  0.521174
                         0.386789  0.095499  0.065901  0.560505
                         0.425342  0.088039  0.063234  0.592196
                         0.460677  0.080979  0.060398  0.617650
                         0.505789  0.072258  0.056881  0.642520
                         0.547226  0.063421  0.052671  0.658906
                         0.584463  0.055336  0.048551  0.666151
                         0.627311  0.046117  0.043566  0.664038
                         0.664746  0.036848  0.038191  0.641358
                         0.701294  0.026518  0.031439  0.591521
                         0.753678  0.013251  0.022298  0.447873
                         0.777667  0.006249  0.017153  0.283306];



%% DA4022_3B
% Static formalisme Omega CT CP



DA4022_4B.Static = [ 1505.000  0.243484  0.161061
                     1796.667  0.240866  0.156181
                     1958.333  0.239311  0.154376
                     2225.000  0.237572  0.150464
                     2453.333  0.239441  0.149536
                     2726.667  0.237467  0.147303
                     2976.667  0.239446  0.147080
                     3203.333  0.241329  0.147320
                     3436.667  0.241883  0.147213
                     3710.000  0.241997  0.146411
                     3938.333  0.244743  0.147676
                     4188.333  0.243839  0.146685
                     4456.667  0.245067  0.147146
                     4698.333  0.246992  0.148069
                     4938.333  0.247589  0.148435];


% INFLOW
% 2034 RPM : J CT CP eta


DA4022_4B.Dynamic{1} = [0.306448  0.174728  0.133182  0.402046
                        0.384997  0.153948  0.124537  0.475918
                        0.467558  0.124802  0.109278  0.533975
                        0.538755  0.100249  0.095172  0.567497
                        0.616961  0.068499  0.075464  0.560011
                        0.700752  0.037511  0.055524  0.473407
                        0.790564  0.002484  0.031073  0.063196];





DA4022_4B.Dynamic{2} = [0.203032  0.201504  0.138079  0.296291
                        0.254553  0.187518  0.133041  0.358785
                        0.307854  0.175856  0.129446  0.418231
                        0.359122  0.161203  0.123425  0.469044
                        0.413187  0.146383  0.117130  0.516383
                        0.464567  0.132065  0.110522  0.555119
                        0.514890  0.112796  0.099892  0.581409
                        0.568108  0.094350  0.089459  0.599161
                        0.620732  0.074098  0.077088  0.596652
                        0.679355  0.050612  0.061932  0.555181
                        0.728111  0.030284  0.047842  0.460895
                        0.789371  0.003020  0.028051  0.084985
                        0.837842 -0.018690  0.011424 -1.370847];




DA4022_4B.Dynamic{3} = [ 0.203032  0.201504  0.138079  0.296291
                         0.254553  0.187518  0.133041  0.358785
                         0.307854  0.175856  0.129446  0.418231
                         0.359122  0.161203  0.123425  0.469044
                         0.413187  0.146383  0.117130  0.516383
                         0.464567  0.132065  0.110522  0.555119
                         0.514890  0.112796  0.099892  0.581409
                         0.568108  0.094350  0.089459  0.599161
                         0.620732  0.074098  0.077088  0.596652
                         0.679355  0.050612  0.061932  0.555181
                         0.728111  0.030284  0.047842  0.460895
                         0.789371  0.003020  0.028051  0.084985
                         0.837842 -0.018690  0.011424 -1.370847];


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% ANALYSE STATIQUE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% DA4022_2B :
Ve = 0.0; % static
J = 0.0;
rho = 1.215;




n = DA4022_2B.Static(:,1)/60;
Omega = n*(2*pi);
CT = DA4022_2B.Static(:,2);
CP = DA4022_2B.Static(:,3);
D = 22.86e-2;
R = D/2;
Ae = pi*R^2


Fe = rho*(n.^2)*(D^4).*CT
Pe = rho*(n.^3)*(D^5).*CP;
DVe = sqrt(Ve^2+(2*Fe)/(rho*Ae))-Ve;



P_RSD = -rho*Ae*(Ve+(1+5*J^2)*0.5*DVe).*(Ve+0.5*DVe).*DVe;
Pv_CDA = (1/8)*sqrt(Ve^2 + (Omega*R).^2).*(Ve+3*(Omega*R).^2);


CDA = (Pe+P_RSD)./Pv_CDA;


figure(1)
plot(n*60,Fe,'-or')
xlabel('n RMP')
ylabel('normalised total effective drag blade area (CDA)/B')
grid on

% DA4022_4B :
Ve = 0.0; % static
J = 0.0;
rho = 1.215;




n = DA4022_4B.Static(:,1)/60;
Omega = n*(2*pi);
CT = DA4022_4B.Static(:,2);
CP = DA4022_4B.Static(:,3);
D = 22.86e-2;
R = D/2;
Ae = pi*R^2


Fe = rho*(n.^2)*(D^4).*CT
Pe = rho*(n.^3)*(D^5).*CP;
DVe = sqrt(Ve^2+(2*Fe)/(rho*Ae))-Ve



P_RSD = -rho*Ae*(Ve+(1+5*J^2)*0.5*DVe).*(Ve+0.5*DVe).*DVe;
Pv_CDA = (1/8)*sqrt(Ve^2 + (Omega*R).^2).*(Ve+3*(Omega*R).^2);


CDA = (Pe+P_RSD)./Pv_CDA;
figure(1)
hold on
plot(n*60,Fe,'-sb')
xlabel('n RMP')
ylabel('normalised total effective drag blade area (CDA)/B')
legend('DA4022 : 2 blades','DA4022 : 4 blades')
grid on

%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Analyse dynamique
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


rho = 1.215;

J = DA4022_2B.Dynamic{1}(:,1);
CT = DA4022_2B.Dynamic{1}(:,2)
CP = DA4022_2B.Dynamic{1}(:,3)

n = 2018/60;
Omega = n*(2*pi);

D = 0.2286;
R = D/2;
Ae = pi*R^2;

Ve = J*Omega*R;


Fe = rho*(n^2)*(D^4)*CT;
Pe = rho*(n^3)*(D^5)*CP;
DVe = sqrt(Ve.^2+(2*Fe)/(rho*Ae))-Ve



P_RSD = -rho*Ae*(Ve+(1+5*J.^2).*0.5.*DVe).*(Ve+0.5*DVe).*DVe;
Pv_CDA = (1/8)*sqrt(Ve.^2 + (Omega*R).^2).*(Ve+3*(Omega*R).^2);

CDA = (Pe-P_RSD)./Pv_CDA;






figure(2)
plot(J,Fe,'-or')
xlabel('advance ratio J')

ylabel('CDA')


rho = 1.215;

J = DA4022_2B.Dynamic{2}(:,1);
CT = DA4022_2B.Dynamic{2}(:,2)
CP = DA4022_2B.Dynamic{2}(:,3)

n = 3000/60;
Omega = n*(2*pi);

D = 0.2286;
R = D/2;
Ae = pi*R^2;

Ve = J*Omega*R;


Fe = rho*(n^2)*(D^4)*CT;
Pe = rho*(n^3)*(D^5)*CP;
DVe = sqrt(Ve.^2+(2*Fe)/(rho*Ae))-Ve



P_RSD = -rho*Ae*(Ve+(1+5*J.^2).*0.5.*DVe).*(Ve+0.5*DVe).*DVe;
Pv_CDA = (1/8)*sqrt(Ve.^2 + (Omega*R).^2).*(Ve+3*(Omega*R).^2);




CDA = (Pe-P_RSD)./Pv_CDA;


figure(2)
hold on
plot(J,Fe,'-ob')
xlabel('advance ratio J')
ylabel('CDA')


rho = 1.215;

J = DA4022_2B.Dynamic{3}(:,1);
CT = DA4022_2B.Dynamic{3}(:,2);
CP = DA4022_2B.Dynamic{3}(:,3);

n = 4000/60;
Omega = n*(2*pi);

D = 0.2286;
R = D/2;
Ae = pi*R^2;

Ve = J*Omega*R;


Fe = rho*(n^2)*(D^4)*CT;
Pe = rho*(n^3)*(D^5)*CP;
DVe = sqrt(Ve.^2+(2*Fe)/(rho*Ae))-Ve



P_RSD = -rho*Ae*(Ve+(1+0*J.^2).*0.5.*DVe).*(Ve+0.5*DVe).*DVe;
Pv_CDA = (1/8)*sqrt(Ve.^2 + (Omega*R).^2).*(Ve+3*(Omega*R).^2);

CDA = (Pe-P_RSD)./Pv_CDA;


figure(2)
hold on
plot(J,Fe,'-ok')
xlabel('advance ratio J')
ylabel('CDA')
grid on
legend('2000 RMP','3000 RPM','4000 RPM')

figure(3)
plot(J,CT)



figure(4)
plot(CP,CT,'-sk')
